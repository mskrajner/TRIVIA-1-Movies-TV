
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Trivia Time</title>
  <style>
    body {
      background: black;
      color: white;
      font-size: 24px;
      font-weight: normal;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
      text-align: center;
      flex-direction: column;
      transition: background 0.5s, color 0.5s;
    }
    .bold { font-size: 36px; font-weight: bold; }
    .option { display: block; margin: 10px 0; font-size: 24px; }
    .correct { font-weight: bold; color: black; }
    button { margin-top: 20px; font-size: 20px; padding: 10px 20px; cursor: pointer; }
  </style>
</head>
<body>
  <div id="category" class="bold">Turn your phone upright for trivia!</div>
  <div id="question"></div>
  <div id="options"></div>
  <button id="showAnswerBtn" style="display:none">Show Answer</button>

  <script>
    // ======== DATA ========
    const questions = [
      {
        category: "TV & MOVIES",
        question: "Who was the TV detective with a rumpled raincoat, a lazy eye, and who always had 'one more question'?",
        options: ["A. Kojak", "B. Columbo", "C. Rockford", "D. Magnum"],
        answer: "B"
      },
      {
        category: "TV & MOVIES",
        question: "Which sitcom featured a wacky alien from the planet Ork who said 'Nanu Nanu'?",
        options: ["A. Happy Days", "B. Mork & Mindy", "C. ALF", "D. My Favorite Martian"],
        answer: "B"
      },
      {
        category: "TV & MOVIES",
        question: "Which cartoon family lived in the future and had a robot maid named Rosie?",
        options: ["A. The Flintstones", "B. The Jetsons", "C. The Addams Family", "D. The Partridge Family"],
        answer: "B"
      },
      {
        category: "TV & MOVIES",
        question: "What show featured Archie, Edith, Gloria, and 'Meathead'?",
        options: ["A. Three’s Company", "B. All in the Family", "C. The Brady Bunch", "D. Cheers"],
        answer: "B"
      },
      {
        category: "TV & MOVIES",
        question: "What kind of TV did many families first have in the 1960s?",
        options: ["A. Wall-mounted", "B. Black and white", "C. Flat screen", "D. Remote-controlled"],
        answer: "B"
      },
      {
        category: "TV & MOVIES",
        question: "What show was known for 'book ’em, Danno' and Hawaiian shirts?",
        options: ["A. Hawaii Five-O", "B. Magnum, P.I.", "C. Miami Vice", "D. The A-Team"],
        answer: "A"
      },
      {
        category: "TV & MOVIES",
        question: "What groundbreaking 1970s sitcom starred a Black family in a high-rise apartment and featured the theme song 'Movin’ On Up'?",
        options: ["A. Sanford and Son", "B. Good Times", "C. The Jeffersons", "D. Diff’rent Strokes"],
        answer: "C"
      }
    ];

    // ======== STATE ========
    let hasQuestion = false;
    let lastAnswerTime = 0;
    let showingAnswer = false;
    let currentQuestion = null;
    let currentIndex = -1;

    // Track recently shown question indexes with timestamps
    const RECENT_MS = 10 * 60 * 1000; // 10 minutes
    /** @type {{i:number, t:number}[]} */
    const recentHistory = [];

    // ======== HELPERS ========
    function now() { return Date.now(); }

    function randomFrom(arr) {
      return arr[Math.floor(Math.random() * arr.length)];
    }

    function purgeOldHistory() {
      const cutoff = now() - RECENT_MS;
      for (let k = recentHistory.length - 1; k >= 0; k--) {
        if (recentHistory[k].t < cutoff) recentHistory.splice(k, 1);
      }
    }

    function markShown(index) {
      recentHistory.push({ i: index, t: now() });
      const cap = questions.length * 5;
      if (recentHistory.length > cap) recentHistory.splice(0, recentHistory.length - cap);
    }

    function pickQuestionIndex() {
      purgeOldHistory();

      const recentSet = new Set(recentHistory.map(h => h.i));
      let candidates = [];
      for (let i = 0; i < questions.length; i++) {
        if (!recentSet.has(i)) candidates.push(i);
      }

      if (candidates.length === 0) {
        candidates = Array.from({ length: questions.length }, (_, i) => i);
      }

      if (candidates.length > 1 && currentIndex !== -1) {
        const filtered = candidates.filter(i => i !== currentIndex);
        if (filtered.length > 0) candidates = filtered;
      }

      return randomFrom(candidates);
    }

    function displayQuestionByIndex(index) {
      currentIndex = index;
      const data = questions[index];
      currentQuestion = data;

      markShown(index);

      document.body.style.background = '#FFD580';
      document.getElementById('category').style.color = 'black';
      document.getElementById('question').style.color = 'black';

      document.getElementById('category').textContent = data.category;
      document.getElementById('question').textContent = data.question;

      const optionsHTML = data.options.map(option => {
        const letter = option.charAt(0);
        return `<span class="option" data-letter="${letter}">${option}</span>`;
      }).join('');

      document.getElementById('options').innerHTML = optionsHTML;
      document.getElementById('options').style.color = 'black';
      document.getElementById('showAnswerBtn').style.display = 'inline-block';

      showingAnswer = false;
    }

    function displayRandomQuestion() {
      const idx = pickQuestionIndex();
      displayQuestionByIndex(idx);
    }

    // ======== UI EVENTS ========
    document.getElementById('showAnswerBtn').addEventListener('click', () => {
      const correctLetter = currentQuestion.answer;
      const options = Array.from(document.querySelectorAll('.option'));

      options.forEach(option => {
        const letter = option.getAttribute('data-letter');
        if (letter === correctLetter) {
          option.classList.add('correct');
        } else {
          option.remove();
        }
      });

      lastAnswerTime = now();
      showingAnswer = true;
    });

    // ======== ORIENTATION / MOTION LOGIC ========
    function applyHighlight(show) {
      const delayPassed = now() - lastAnswerTime > 3000;

      if (show && !hasQuestion && (!showingAnswer || delayPassed)) {
        hasQuestion = true;
        displayRandomQuestion();
      } else if (!show) {
        hasQuestion = false;
        document.body.style.background = 'black';
        document.getElementById('category').style.color = 'white';
        document.getElementById('category').textContent = 'Turn your phone upright for trivia!';
        document.getElementById('question').textContent = '';
        document.getElementById('options').innerHTML = '';
        document.getElementById('showAnswerBtn').style.display = 'none';
      }
    }

    function handleOrientation() {
      const o = screen.orientation?.type || window.orientation;
      const isPortrait = (typeof o === 'string' && o.includes('portrait')) ||
                         (typeof o === 'number' && (o === 0 || o === 180));
      applyHighlight(isPortrait);
    }

    function handleMotion(event) {
      const z = event.accelerationIncludingGravity?.z || 0;
      const isUpright = z > 7;
      applyHighlight(isUpright);
    }

    function initListeners() {
      if ('DeviceMotionEvent' in window) {
        if (typeof DeviceMotionEvent.requestPermission === 'function') {
          DeviceMotionEvent.requestPermission().then(response => {
            if (response === 'granted') {
              window.addEventListener('devicemotion', handleMotion);
            } else {
              fallbackToOrientation();
            }
          }).catch(fallbackToOrientation);
        } else {
          window.addEventListener('devicemotion', handleMotion);
        }
      } else {
        fallbackToOrientation();
      }
    }

    function fallbackToOrientation() {
      if ('screen' in window && 'orientation' in screen) {
        screen.orientation.addEventListener('change', handleOrientation);
        handleOrientation();
      } else if ('orientation' in window) {
        window.addEventListener('orientationchange', handleOrientation);
        handleOrientation();
      } else {
        alert('Orientation detection not supported.');
      }
    }

    // Kickoff
    initListeners();
  </script>
</body>
</html>
